<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Store - Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-wrapper">
            <a href="admin.html" class="brand-logo">Logo</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="adminusers.html">Usuarios</a></li>
                <li><a href="adminemployes.html">Empleados</a></li>
                <li><a href="admin.html"></a></li>
            </ul>
        </div>
    </nav>
        <ul class="tabs" id="tabs">
            <li class="tab col s3"><a class="active" href="#tabPrd" data-tab="tabPrd" data-module="products">Productos</a></li>
            <li class="tab col s3"><a href="#tabCat" data-tab="tabCat" data-module="categories">Categorias</a></li>
            <li class="tab col s3"><a href="#tabProvider" data-tab="tabProvider" data-module="providers">Proveedores</a></li>
            <li class="tab col s3"><a href="#tabUser" data-tab="tabUser" data-module="users">Usuarios</a></li>
            <li class="tab col s3"><a href="#tabFeature" data-tab="tabFeature" data-module="features">Permisos</a></li>
            <li class="tab col s3"><a href="#tabBill" data-tab="tabBill" data-module="bills">Facturas</a></li>
        </ul>
        <div id="tabPrd" class="col s12">
            <!-- ... -->
        </div>
        <!-- SECCION PARA LAS CATEGORIAS -->
        <div id="tabCat" class="col s12">
            <!-- ... -->
        </div>
        <!-- SECCION PARA LOS PROVEEDORES -->
        <div id="tabProvider" class="col s12">
            <!-- ... -->
        </div>
        <!-- SECCION PARA LOS USUARIOS -->
        <div id="tabUser" class="col s12">
            <!-- ... -->
        </div>
        <div id="tabFeature" class="col s12">
            <!-- ... -->
        </div>
        <div id="tabBill" class="col s12">
            <!-- ... -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="main.js"></script>
    <script>
        function clearForms(form) {
            $(`form`).find('input:text, input:password, input:file, input[type=date], input[type=email], input[type=tel], input[type=number], select, textarea').val('');
            $(`form`).data('action', 'create');
            $(`form`).data('id', 0);
        }
        
        function adminPetition(url, data, method, next, form = null) {
            console.log('adminPetition>', url, data, method, next, 'Hay tabla?', form);
            if (method == "GET") {
                $.get(url, (res) => {
                    res = res.response;
                    console.log('GET petition response is',res);
                    if (res[1].status == 'ok') {
                        if (form != null) {
                            clearForms(form);
                        }
                        showToast(res[1], 'green rounded');
                        nextStep(next, res[0]);
                    } else {
                        showToast(res[1], 'red rounded');
                    }
                }, 'json');
            } else if (method == "POST") {
                $.post(url, JSON.stringify(data), (res) => {
                    res = res.response;
                    console.log('POST petition response is', res);
                    
                    if (res[1].status == 'ok') {
                        if (form != null) {
                            clearForms(form);
                        }
                        showToast(res[1], 'green rounded');
                        nextStep(next, res[0]);
                    } else {
                        showToast(res[1], 'green rounded');
                    }
                }, 'json');
            }
        }
        function nextStep(step, data) {
            console.log('nextStep>', step, data);
            switch (step) {
                case 'selectCategories':
                    showSltCategories(data);
                case 'tableCategories':
                    showCategories(data);
                    break;
                case 'reloadCategories':
                    adminPetition('http://localhost:3000/show_categories', {}, 'GET', 'tableCategories');
                    break;
                case 'selectProviders':
                    showSltProviders(data);
                case 'tableProviders':
                    showProviders(data);
                    break;
                case 'reloadProviders':
                    adminPetition('http://localhost:3000/show_providers', {}, 'GET', 'tableProviders');
                    break;
                case 'tableProducts':
                    showProducts(data);
                    break;
                case 'reloadProducts':
                    adminPetition('http://localhost:3000/show_products', {}, 'GET', 'tableProducts');
                    break;
                default:
                    break;
            }
        }
        function showToast(message, type) {
            console.log('showToast', message, type);
            M.toast({
                html: message.msg,
                classes: type
            });
        }
        $(document).ready(function(){
            $('select').formSelect();
            $('.tabs').tabs();
            $("select[required]").css({display: "block", height: 0, padding: 0, width: 0, position: 'absolute'});
            $('textarea#txtCatDescription, input#txtCatName, #txtProvName, #txtProvPhone, #txtProvEmail').characterCounter();
            $('#vidContainer').hide();

            
        });
    </script>
</body>
</html>